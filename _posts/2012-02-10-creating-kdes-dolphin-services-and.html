---
layout: post
comments: true
title: Creating KDE's Dolphin services and integrating AES Crypt into it
date: '2012-02-10T23:11:00.000Z'
author: Igor Duarte Cardoso
tags:
- KDE
- Encryption
- Linux
- Dolphin
modified_time: '2013-05-12T20:06:54.177+01:00'
thumbnail: http://1.bp.blogspot.com/-BUbffoEjd5Y/TzWfakPTkdI/AAAAAAAAAKw/KflNT5P1YLo/s72-c/dolphin.png
blogger_id: tag:blogger.com,1999:blog-7503515668102711213.post-8159760698933769682
blogger_orig_url: http://igordcard.blogspot.com/2012/02/creating-kdes-dolphin-services-and.html
---

The main objective of this post is to give you a quick glance at how you can create <b>service</b> menus and plugins for use under <b>Dolphin</b>, the default file manager in KDE. <br /><br />In order to achieve the goal, you need to know what service you want to create for Dolphin. That's where I present you <b>AES Crypt</b>, a nice simple application that allows you to encrypt/decrypt your files in an easy and cross-platform way. Unfortunately, the linux version lacks some features, like UI integration (for obvious reasons), and it's up to us users to make something about it.<br /><br /><br /><a name='more'></a><br />As such, I will show you how to integrate AES Crypt with one specific file manager you can use on Linux, KDE's Dolphin, as I mentioned before. That way, you'll be able to quickly call AES Crypt inside Dolphin, just like the Windows version, no need to pop out the terminal and type <code>aescrypt -e</code> or <code>aescrypt -d</code> everytime.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="161" src="/assets/dolphin.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Dolphin Preferences, showing the AES service installed.</td></tr></tbody></table><br /><br />Let's start then:<br /><br /><b>Create the service file:</b><br /><br />The whole service goes into just one file, and that is the one you will be creating. Create an empty text file and save it with the <b>.desktop</b> extension. The full name I used was <code>aes.desktop</code>.<br /><br /><br /><b>Define the basic structure:</b><br /><br />Like in any other .desktop file, you must define the <b>desktop entry</b> section. You start it with:<br /><br /><pre class="prettyprint">[Desktop Entry]</pre><br />Inside this section, you will put the pairs of keys and values that will tell Dolphin what this .desktop file is all about. However, let's postpone that task for now.<br /><br /><br />Below the desktop entry line, add the following two lines, which define <b>desktop actions</b>:<br /><br /><pre class="prettyprint">[Desktop Action encrypt]<br /><br />[Desktop Action decrypt]<br /></pre><br />The first line will tell Dolphin what to do when you ask it to <b>encrypt</b> a file, the second one will tell it what to do when you want to <b>decrypt</b> a file. You are free to name the actions as you wish. I named them <code>encrypt</code> and <code>decrypt</code>.<br /><br />The basic structure is done. A <b>desktop entry</b> section and one <b>desktop action</b> section for each atomic thing you want to do. Now you just need to populate these sections with usefulness. <br /><br /><b>Populate the desktop entry:</b><br /><br />Inside this section you will put the pairs of keys and values that will make the file recognizable as a Dolphin service as well as what actions does it offer. The way I'll show you will create an option with a submenu. The submenu will then let you encrypt or decrypt the file you have selected under Dolphin.<br /><br />So, add the following lines:<br /><br /><pre class="prettyprint">Type=Service</pre>This line tells that the desktop file describes a service.<br /><br /><pre class="prettyprint">X-KDE-ServiceTypes=KonqPopupMenu/Plugin</pre>This one will make Dolphin know that it must show an option on the context menu with our service.<br /><br /><pre class="prettyprint">MimeType=all/all</pre>We want the context menu to appear in all kinds of files, so we set the mime type to everything (<code>all/all</code>).<br /><br /><pre class="prettyprint">Icon=kgpg</pre>What icon should our desktop file have. More importantly, what icon will appear in our option of the context menu. I used the kgpg icon that requires having kgpg installed.<br /><br /><pre class="prettyprint">Actions=encrypt;decrypt;</pre>This key is crucial because it lists all the actions supported (semicolon separated). The names you gave to the desktop actions before must be the same as the ones you list in this line.<br /><br /><pre class="prettyprint">X-KDE-Submenu=AES</pre>Finally, what should be the name of our context menu option? I named it just "AES".<br /><br /><br /><b>Populate the desktop actions:</b><br /><br />For each action you define, you will give a name, an icon (to show in the submenu option) and a command to execute (for calling AES Crypt). So, put the following pairs of keys next to the beginning of <code>encrypt</code> desktop action: <br /><br /><pre class="prettyprint">Name=Encrypt<br />Icon=kgpg<br /></pre>Here I call the <code>encrypt</code> action "Encrypt" and set the kgpg icon, just like the main context menu option.<br /><br /><pre class="prettyprint">Exec=aescrypt -e -p `kdialog --password "Insert desired password:" --title "AES Encryption"` "%f"<br /></pre>The key <code>Exec</code> is where all the magic happens. When the user selects "Encrypt" in the context menu submenu, the above command will automatically run. What it does is call AES Crypt on the file currently selected (<code>"%f")</code> and encrypt it with a password provided by KDialog. Using KDialog, you can quickly create simple window dialogs to show or input information. The KDialog I used will ask the user for a password, as shown in the picture below:  <br /><div class="separator" style="clear: both; text-align: center;"><a imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="218" src="/assets/kdialog.png" width="320" /></a></div><br /><br />Now, for the second action (decrypt), it's pretty much the same:<br /><pre class="prettyprint">Name=Decrypt<br />Icon=kgpg<br />Exec=aescrypt -d -p `kdialog --password "Provide required password:" --title "AES Decryption"` "%f"<br /></pre><br /><b>Install the plugin:</b><br /><br />Now that you have a full service written, it's time for Dolphin to make use of it. To accomplish that, you can either copy the file to <code>~/.kde4/share/kde4/services/ServiceMenus/</code> directory (create it if it doesn't exist) or to <code>/usr/share/kde4/services/ServiceMenus/</code> (create it if it doesn't exist), assuming a typical installation of GNU/Linux. Remember that you should avoid messing with the global directories (like /usr) to maintain your system consistent with your package manager and to avoid sad lucks, so I recommend putting the file in your home. By the way, the tilde (~) represents you home directory.<br /><br /><b>Give it a try:</b><br /><br />Assuming that you have AES Crypt installed as well as KDE, you should now be able to fire up Dolphin, select a file, right click on it, select <b>AES</b> and finally select <b>Encrypt</b>. A KDialog will appear, input your password, and a new file will be created with the name of the non-encrypted plus the .aes extension. Check the contents of the file, you can't understand a thing! It's encrypted. Now go to the <b>AES</b> submenu again and select <b>Decrypt</b>. You will be asked for the password, type it and you will recover the file.<br /><div class="separator" style="clear: both; text-align: center;"><a imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="215" src="/assets/aescrypt.png" width="320" /></a></div><br /><br />As you can see, creating a service plugin for Dolphin is pretty straightforward and can help ease and fasten some tasks that would be boring otherwise, especially daily ones.<br /><br />Give AES Crypt a try as it works very flawlessly and is compatible both with Windows, Linux and Mac OS. You can easily secure and move your files from system to system (oh Android and iOS...).<br /><br /><br /><br />You can download the whole service file: <a href="http://igordcard.googlecode.com/hg/dolphin/aes.desktop">Here</a>.<br /><br /><br /><b>A few useful links:</b><br /><a href="http://www.aescrypt.com/">AES Crypt</a><br /><a href="http://fognl.com/doc/kde/HTML/en/kdebase-apidocs/libkonq/html/classKonqPopupMenu.html">KonqPopupMenu</a><br /><a href="http://techbase.kde.org/Development/Tutorials/Shell_Scripting_with_KDE_Dialogs">KDE Dialogs</a><br /><br /><b>Atualização em 2013/05/12</b>:<br />Uma versão deste artigo em português pode agora ser consultada no website do <a href="http://glua.ua.pt/glua/tutorial/criar-um-menu-de-servico-para-o-dolphin-kde-e-integrar-o-aes-crypt/">Grupo de Linux da Universidade de Aveiro</a>.
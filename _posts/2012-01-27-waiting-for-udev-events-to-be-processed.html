---
layout: post
comments: true
title: Waiting for UDev events to be processed
date: '2012-01-27T00:41:00.000Z'
author: Igor Duarte Cardoso
tags:
- Linux
- Arch Linux
- UDev
modified_time: '2012-03-15T10:09:35.459Z'
blogger_id: tag:blogger.com,1999:blog-7503515668102711213.post-4306776982528035685
blogger_orig_url: http://igordcard.blogspot.com/2012/01/waiting-for-udev-events-to-be-processed.html
---

A couple of days ago my netbook started taking too long to start up and giving me timeouts while processing events from UDev.<br />This happened during the boot auto-detection of devices in my distro of choice, Arch Linux.<br />I found out that it was related to my wireless adapter, Broadcom BCM4313 and a recent commit to udev.<br /><br />I will present the issue encountered and a possible solution for it. I will especifically show how to do it under Arch Linux and, finally, I will leave you some useful links.<br /><br /><br /><a name='more'></a><b>During the boot I ran into the following bunch of lines:</b><br /><pre class="prettyprint lang-html">Loading User-specified Modules&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [DONE]<br />Waiting for UDev uevents to be processed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [BUSY]udevd[131]: worker [138] timeout, kill it<br /><br />udevd[132]: seq 1077 '/devices/pci0000:00/0000:00:1c.0/0000:05:00:0' killed<br /><br />udevd[132]: worker [139] terminated by signal 9 (Killed)<br /></pre>In addition, the boot time was severely hit because the <code>Waiting for UDev uevents to be processed</code> part would take too long and timeout.<br /><br />In my journey to fix this issue, I first ran <code>lspci</code> to check which device was causing this failure and found out it was my Broadcom BCM4313 wireless adapter:<br /><pre class="prettyprint lang-html">$ lspci -s 0000:05:00.0<br />05:00.0 Network controller: Broadcom Corporation BCM4313 802.11b/g/n Wireless LAN Controller (rev 01)<br /></pre><br />Then, I got the name of the module loaded for my card:<br /><pre class="prettyprint lang-html">$ lspci -vin -s 0000:05:00.0<br />05:00.0 Class 0280: Device 14e4:4727 (rev 01)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Subsystem: Device 185f:051a<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Flags: bus master, fast devsel, latency 0, IRQ 16<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Memory at f0100000 (64-bit, non-prefetchable) [size=16K]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Capabilities: &lt; access denied &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Kernel driver in use: brcmsmac<br /></pre><br />Now that I knew the module name was "<b>brcmsmac</b>", I decided to add it to my <b>/etc/rc.conf MODULES </b>section, thus making the adapter already available before the udev detection process.<br /><br />It worked and my boot time got reduced and more elegant.<br /><br /><br /><b>If you are having the same problem</b>, you should add the module to your boot init script (/etc/rc.conf is one of the ways in Arch Linux), or you can build a cpio kernel image with the module already bundled (but make sure to, somehow, add the required firmware drivers or it won't work because the initial ramfs can't access the root file system).<br /><br />I have also researched about this problem and <b>it seems to affect many cards</b> as this was generally caused by a recent commit in UDev. So, <b>the solution is easily portable to other devices</b> and kernel modules, you just need to know what those are first (for instance using lspci and the device ID reported by the boot errors and matching them with a kernel module, like I did above).<br /><br />Now, in more detail, <b>how to fix this problem in Arch Linux</b> with /etc/rc.conf:<br /><ol><li>Make sure you know the name of the module that is failing detection during the boot, as I explained in the paragraph above; </li><li>Under root, <b>edit /etc/rc.conf</b>;</li><li> Find a line stating MODULES=(module1 module2 etc);</li><li>Inside these brackets put the kernel module of your device/adapter (that you found using <code>lspci -vin -s</code>) , like: MODULES=(<b>mymodule</b>) or MODULES=(othermodule <b>mymodule</b>), if you already have other modules manually declared; </li><li>In my case, I ended up with: MODULES=(<b>brcmsmac </b>acpi-cpufreq coretemp), where brcmsmac is the module of my Broadcom BCM4313, which comes with the linux kernel since version 2.6.39;</li><li>When you have edited rc.conf, quit and save it, restart the computer and you should now have a proper clean startup. </li></ol><br />To complete, I'm leaving you some related links:<br /><br /><ul><li><a href="https://wiki.archlinux.org/index.php/Rc.conf">Editing rc.conf</a>&nbsp;</li><li><a href="https://bbs.archlinux.org/viewtopic.php?id=134012&amp;p=3">Arch Linux related forum post</a>&nbsp;</li><li><a href="http://www.spinics.net/lists/netdev/msg185742.html">UDev recent changes</a></li></ul><div><b><br /></b></div><div><b>Update</b><b>&nbsp;of 2012/03/15:</b></div><div><ul><li><a href="https://bugs.archlinux.org/task/27938">Arch Linux bug report (very useful link)</a>&nbsp;</li></ul></div>